<?php
/** @var Episciences_Paper $paper */
$paper = $this->paper;
$metadata = $this->metadata;
$countEnrichmentMeta = 0;
?>

<?php if (!empty($metadata)) : ?>

    <div class="panel panel-default collapsable" id="paper-files">
        <div class="panel-heading">
            <h2 class="panel-title"><?= $this->translate('Données liées') ?></h2>
        </div>
        <div class="panel-body in">
            <table class="table table-striped">
                <tbody>
                    <?php foreach ($metadata as $sourceId => $metadataArray) : ?>
                        <tr>
                            <td>
                                <?php foreach ($metadataArray as $k => $meta) : ?>
                                    <?php if ($k !== "metatext" && is_null($meta->getMetatext())) : ?>
                                        <?=strtoupper($this->translate($meta->getName())) ?> <a href="<?= $meta->getLink() ?>"><?= $meta->getValue() ?></a><br>
                                    <?php elseif($k !== "metatext" && !is_null($meta->getMetatext())) : ?>
                                        <?= $meta->getRelationship() ?>&nbsp;<?= strtoupper($this->translate($meta->getName())) ?> <a href="<?= $meta->getLink() ?>"><?= $meta->getValue() ?></a><br>
                                        <?php  $countEnrichmentMeta++; ?>
                                        <?php if ($countEnrichmentMeta === count($metadataArray)-1) : ?>
                                            <?php foreach ($metadataArray['metatext'] as $kmeta => $typemeta) : ?>
                                                <ul>
                                                    <?php foreach ($typemeta['identifiers'] as $key => $value) : ?>
                                                        <li>
                                                            <span><?= $this->escape($value['identifier']) ?></span>
                                                        </li>
                                                    <?php endforeach; ?>
                                                </ul>
                                                <span style="font-weight: bold"><?= $this->escape($typemeta['title']) ?></span><br>
                                                <?php foreach ($typemeta['creators'] as $key => $value) : ?>
                                                    <span><?= $value['name'] ?>
                                                        <?php if ($value['identifiers'] !== null) : ?>
                                                            <?php foreach ($value['identifiers'] as $identifierInfo) : ?>
                                                                <span><?= $this->escape($identifierInfo['identifier']) ?></span>
                                                            <?php endforeach; ?>
                                                        <?php endif;?>
                                                    </span>;
                                                <?php endforeach; ?>
                                            <?php endforeach; ?>
                                        <?php endif;?>
                                    <?php endif; ?>
                                <?php endforeach; ?>
                            </td>
                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </div>
<?php endif; ?>