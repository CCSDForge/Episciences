<?php
/** @var Episciences_Paper $paper */
$paper = $this->paper;
$datasets = $paper->getDatasets()
?>

<?php if (!empty($datasets)) : ?>

    <div class="panel panel-default collapsable" id="paper-files">
        <div class="panel-heading">
            <h2 class="panel-title"><?= $this->translate('Données liées') ?></h2>
        </div>
        <div class="panel-body in">
            <table class="table table-striped">
                <tbody>
                    <tr>
                        <td>
                            <?php /** @var  Episciences_Paper_Dataset $oDataset */ ?>
                            <?php foreach ($paper->getDatasets() as $key => $oDataset) : ?>
                                <?php if ($key !== "metatext") :  ?>
                                    <?php $href = $oDataset->getLink(); ?>
                            <?= $oDataset->getRelationship() ?> <?= strtoupper($this->translate($oDataset->getName())) ?> <a href="<?= $href ?>"><?= $oDataset->getValue() ?></a><br>
                                <?php endif;?>
                            <?php endforeach; ?>
                                <ul>
                                    <?php foreach ($paper->getDatasets()['metatext']['identifiers'] as $key => $value) :     ?>
                                        <li>
                                            <span><?= $this->escape($value['identifier']) ?></span>
                                        </li>
                                    <?php endforeach; ?>
                                </ul>
                                <span style="font-weight: bold"><?= $this->escape($paper->getDatasets()['metatext']['title']) ?></span><br>
                                <?php foreach ($paper->getDatasets()['metatext']['creators'] as $key => $value) : ?>
                                    <span><?= $value['name'] ?>
                                        <?php if ($value['identifiers'] !== null) : ?>
                                            <?php foreach ($value['identifiers'] as $identifierInfo) : ?>
                                                <span><?= $identifierInfo['identifier'] ?></span>
                                            <?php endforeach; ?>
                                        <?php endif;?>
                                    </span>;
                                <?php endforeach; ?>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
<?php endif; ?>